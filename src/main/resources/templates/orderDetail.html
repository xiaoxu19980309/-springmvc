<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>订单详情</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" href="../css/jquery.growl.css">
    <style>
        body{
            background: #f2f2f2
        }
        .sd{
            width: 100%;
            padding-top: 68px;

        }
        .swrap{
            margin: 0 114.5px;
        }
        .pd{
            width: 100%;
            height: 54px;
            padding-top: 40px;
        }
        .pd>p{
            font-size: 30px;
            color: rgb(51,51,51);
            font-weight: 400;
            margin-bottom: 6px;
        }
        .dtrolley{
            border: 1px solid rgb(221,221,221);
            border-bottom: none;
            border-radius: 3px;
            margin-bottom: 120px;
        }
        .dhead{
            height: 22px;
            padding: 16px 30px;
            background: white;
            border-bottom: 1px solid rgb(221,221,221);
            border-radius: 3px;
            font-size: 12px;
            line-height: 22px;
            color: rgb(102,102,102);
        }
        .ch{
            height: 16px;
            width: 16px;
            vertical-align: middle;
        }
        .dhead .ch{
            margin-top: -2px;
            margin-right: 9px;
        }
        .dhead>span{
            height: 18px;
            display: inline-block;
            padding-top: 2px;
        }
        .dhs2{
            width: 65px;
        }
        .dhs3{
            width: 544px;
        }
        .dhs4{
            width: 96.8px;
        }
        .dhs5{
            width: 121px;
        }
        .dhs6{
            width: 109px;
        }
        .dhs7{
            width: 56px;
        }
        .dtb{
          /* width: 100%; */
          position: relative;
        }
        .dtb>ul>li{
            /* width: 1118px; */
            height: 101px;
            margin-top: 10px;
            border-bottom: 1px solid rgb(221,221,221);
            position: relative;
        }
        .dtb>ul>li>div>span{
            float: left;
            font-size: 12px;
            color: rgb(102,102,102);
        }
        .dtb>ul>li>div{
            /* width: 1058px; */
            height: 100px;
            padding: 0 30px;
            border-top: 1px solid rgb(221,221,221);
            background: white;
        }
        .dtb>ul>li img{
            width: 60px;
            height: 60px;
        }
        .dtb>ul .ch{
            margin-top:43px
        }
        .dtb>ul .dhs2{
            width: 60px;
            height: 60px;
            margin: 20px 0 20px 0px;
            line-height: 99px;
        }
        .dtb>ul .dhs3{
            width: 290px;
            height: 18px;
            padding: 20px 38px 20px 12px;
        }
        .dtb>ul .dhs3>a{
            color: rgb(51,51,51);
            text-decoration: none;
        }
        .dtb>ul .dhs4{
            margin-left: 140px;
            margin-top: 23px;
            width: 100px;
            height: 18px;
            padding: 20px 0;
        }
        .dtb>ul .dhs5{
            width: 120px;
            height: 18px;
            padding: 20px 0;
            margin-left: 0;
            margin-top: 23px;
        }
        .dtb>ul .dhs6{
            width: 116px;
            height: 18px;
            margin-top: 23px;
            padding: 20px 0;
        }
        .dtb>ul .dhs7{
            width: 24px;
            height: 18px;
            padding: 20px 0;
            margin-top: 23px;
            margin-left: 2px;
        }
        .dtb>ul .dhs7>a{
            text-decoration: none;
            color: #666;
            font-size: 12px;
        }
        .dtb>ul .add,.sub{
            text-decoration: none;
            font-size: 14px;
            font-weight:bold;
            color: rgb(102,102,102);
        }
        .dtb>p{
            width: 1118px;
            height: 101px;
            margin-top: 10px;
            border-bottom: 1px solid rgb(221,221,221);
            position: relative;
        }
        .payBtn{
            position: absolute;
            right: 30px;
            margin-top: 10px;
            background-color: rgb(255, 68, 68);
            color: white;
            padding: 0 60px;
            border: none;
            font-size: 18px;
            line-height: 46px;
        }
    </style>
</head>
<body>
    <div class="navigation">
        <div class="wrap">
            <a href="#" class="logo"><img src="../image/logo.png" alt="" class="logoi"></a>
            <ul class="ul-bar-left">
                <li><a href="" class="word chakan" id="chak">查看所有类别</a></li>
                <li><a href="./" class="word">首页</a></li>
                <li><a href="./allproducts" class="word">所有商品</a></li>
            </ul>
            <ul class="ul-bar-right">
                <li class="word a0"></li>
                <li class="img2"><img src="../image/0.png" alt=""></li>
                <li class="isLogin"><a href="./register.html" class="word zhuc">注册</a></li>
                <li class="word ash isLogin">|</li>
                <li class="isLogin"><a href="./login.html" class="word dengl">登录</a></li>
                <li class="login-out"><a href="#" class="word" onclick="loginOut()">退出</a></li>
                <li class="login-out">
                    <a href="" class="word" id="person" style="text-align: center;">个人中心</a>
                    <div id="personList" class="wrap3">
                        <ul>
                            <li style="float: none;"><a class="word" href="./changePsw">修改密码</a></li>
                            <li style="float: none;"><a class="word" href="./orderList">历史订单</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
        <div class="wrap2" id="lb">
            <ul></ul>
            <div class="wA1"></div>
            <div class="wA2"></div>
            <div class="wA3"></div>
        </div>
    </div>
    <div class="sd">
        <div class="swrap">
            <div class="pd">
                <p>订单详情</p>
            </div>
            <div class="dtrolley">
                <div class="dhead">
                    <span class="dhs3">商品名称</span>
                    <span class="dhs4">单价</span>
                    <span class="dhs5">数量</span>
                    <span class="dhs6">小计</span>
                </div>
                <div class="dtb">
                    <ul class="shopList">
                        <li th:each="detail,iterStat:${detailList}">
                            <div>
                                <span class="dhs2"><img src="../image/img23.png" alt=""></span>
                                <span class="dhs3"><a href="#" th:text="${detail.name}"></a></span>
                                <span class="dhs4">￥<span th:text="${detail.price}"></span></span>
                                <span class="dhs5"><span th:text="${detail.number}"></span>件</span>
                                <span class="dhs6">￥<span th:text="${detail.itemcount}"></span></span>
                            </div>
                        </li>
                    </ul>
                    <button class="payBtn" id="topay" th:if="${is_pay==null}">支付</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal">
        <div class="content">
            <p>请选择支付方式</p>
            <div>
                <input type="radio" name="payType" id="ali" value="1">支付宝
                <input type="radio" name="payType" id="wepay" value="2">微信
            </div>
            <button id="payConfirm">确定</button>
            <button id="cancel" class="cancel">取消</button>
        </div>
    </div>
</body>
<script src="../js/leibie.js"></script>
<script src="../js/public.js"></script>
<script src="../jq1.11.1/jquery.min.js"></script>
<script src="../js/jquery.growl.js"></script>
<script>
    var typeList = []
    var ul = $('.wrap2 ul')
    var div1 = $('.wrap2 .wA1')
    var div2 = $('.wrap2 .wA2')
    var div3 = $('.wrap2 .wA3')
    var url = location.href.split("?")[1]
    var obj = {}
    var keys = url.split("&")
    for(var i=0;i<keys.length;i++){
        var key = keys[i].split("=")[0]
        var value = keys[i].split("=")[1]
        obj[key] = value;
    }
    var order_id = obj.order_id
    var modal = document.getElementsByClassName("modal")[0]
    $content1 = null
    $content2 = null
    $content3 = null
    function getTypeList(){
        $.ajax({
            url: '/common/getTypeAndGoods',
            type: 'post',
            data: {
                pageSize: 10,
                pageNum: 1
            },
            beforeSend: function(request){
                request.setRequestHeader("Authorization",token);
            },
            success: function(res){
                if(res.resultCode!=200){
                    $.growl({
                        title: "提示",
                        message: res.resultMsg
                    })
                }else{
                    typeList = res.data.list
                    for(var i=0;i<typeList.length;i++){
                        ul.append("<li><a href=''>"+typeList[i].type_name+"</a></li>")
                    }
                    addMouseOver()
                }
            },
            error: function(e){
            }
        });
    }
    function addMouseOver(){
        $('.wrap2 ul li').mouseover(function(e){
            var i = $(this).index()
            console.log(i,"index")
            if(typeList[i].goodsList.length==0){
                if($content1!=null)
                    $content1.remove();
                if($content2!=null)
                    $content2.remove();
                if($content3!=null)
                    $content3.remove();
            }
            if(typeList[i].goodsList.length==1){
                if($content1!=null)
                    $content1.remove();
                $content1 = $("<a href=\"#\" class=\"w2I\"><img src='../image/img101.png' alt=''></a>" +
                    "<a href=\"#\" class=\"w2P1\"><p>"+typeList[i].goodsList[0].goods_name+"</p></a>" +
                    "<p class='w2P2'>￥"+typeList[i].goodsList[0].goods_price+"</p>")
                div1.append($content1);
            }
            if(typeList[i].goodsList.length==2){
                if($content1!=null)
                    $content1.remove();
                $content1 = $("<a href=\"#\" class=\"w2I\"><img src='../image/img101.png' alt=''></a>" +
                    "<a href=\"#\" class=\"w2P1\"><p>"+typeList[i].goodsList[0].goods_name+"</p></a>" +
                    "<p class='w2P2'>￥"+typeList[i].goodsList[0].goods_price+"</p>")
                div1.append($content1)
                if($content2!=null)
                    $content2.remove();
                $content2=$("<a href=\"#\" class=\"w2I\"><img src='../image/img101.png' alt=''></a>" +
                    "<a href=\"#\" class=\"w2P1\"><p>"+typeList[i].goodsList[1].goods_name+"</p></a>" +
                    "<p class='w2P2'>￥"+typeList[i].goodsList[1].goods_price+"</p>")
                div2.append($content2)
            }
            if(typeList[i].goodsList.length==3){
                if($content1!=null)
                    $content1.remove();
                $content1 = $("<a href=\"#\" class=\"w2I\"><img src='../image/img101.png' alt=''></a>" +
                    "<a href=\"#\" class=\"w2P1\"><p>"+typeList[i].goodsList[0].goods_name+"</p></a>" +
                    "<p class='w2P2'>￥"+typeList[i].goodsList[0].goods_price+"</p>")
                div1.append($content1)
                if($content2!=null)
                    $content2.remove();
                $content2=$("<a href=\"#\" class=\"w2I\"><img src='../image/img101.png' alt=''></a>" +
                    "<a href=\"#\" class=\"w2P1\"><p>"+typeList[i].goodsList[1].goods_name+"</p></a>" +
                    "<p class='w2P2'>￥"+typeList[i].goodsList[1].goods_price+"</p>")
                div2.append($content2)
                if($content3!=null)
                    $content3.remove()
                $content3=$("<a href=\"#\" class=\"w2I\"><img src='../image/img101.png' alt=''></a>" +
                    "<a href=\"#\" class=\"w2P1\"><p>"+typeList[i].goodsList[2].goods_name+"</p></a>" +
                    "<p class='w2P2'>￥"+typeList[i].goodsList[2].goods_price+"</p>")
                div3.append($content3)
            }

        })
    }
    $('#topay').click(function(){
        modal.style.display = "block";
    })
    $('#cancel').click(function(){
        modal.style.display = 'none';
    })
    $('#payConfirm').click(function(){
        var payType = $("input[name='payType']:checked").val()
        var data = {
            token: sessionStorage.getItem("token"),
            order_id: order_id,
        }
        if(payType==undefined){
            $.growl.error({
                title: "提示",
                message: "请选择支付方式！"
            })
            return;
        }
        data.pay_type = payType
        $.ajax({
            url: "/api/order/payOrder",
            type: "POST",
            data: data,
            beforeSend: function(request){
                request.setRequestHeader("Authorization",sessionStorage.getItem("token"));
            },
            success: function(res){
                if(res.resultCode!=200){
                    $.growl.error({
                        title: "提示",
                        message: res.resultMsg
                    })
                }else{
                    $.growl.notice({
                        title: "提示",
                        message: res.resultMsg
                    });
                    modal.style.display = 'none';
                    window.location.href='./orderList'
                }
            },
            error: function(e){

            }
        })
    });
    window.onload = function(){
        checkToken();
        getTypeList();
        if(sessionStorage.getItem("token")){
            getCar();
        }
    }
</script>
</html>















